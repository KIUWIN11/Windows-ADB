name: ‚ùÑÔ∏è Snow ARM

on:
  workflow_dispatch:

jobs:
  UI-PASS:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    # üîê ENABLE RDP
    - name: üîê Enable RDP
      run: |
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name fDenyTSConnections -Value 0 -Force
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
        netsh advfirewall firewall add rule name="RDP" dir=in action=allow protocol=TCP localport=3389
        Restart-Service TermService -Force

    # üë§ CREATE USER
    - name: üë§ Create RDP User
      run: |
        $User = "Kiubby"
        $Password = "Tt@pb2b!"
        $Secure = ConvertTo-SecureString $Password -AsPlainText -Force
        New-LocalUser -Name $User -Password $Secure -AccountNeverExpires -ErrorAction SilentlyContinue
        Set-LocalUser -Name $User -Password $Secure -ErrorAction SilentlyContinue
        Add-LocalGroupMember -Group Administrators -Member $User
        Add-LocalGroupMember -Group "Remote Desktop Users" -Member $User
        echo "RDP_PASS=$Password" >> $env:GITHUB_ENV

    # üè∑Ô∏è CHANGE TO WINDOWS 11 PRO 26H1
    - name: üè∑Ô∏è Change to Windows 11 Pro 26H1
      run: |
        # Change Windows name to Windows 11 Pro
        reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v "ProductName" /t REG_SZ /d "Windows 11 Pro" /f
        reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v "EditionID" /t REG_SZ /d "Professional" /f
        
        # Change version to 26H1
        reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v "ReleaseId" /t REG_SZ /d "26H1" /f
        reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v "DisplayVersion" /t REG_SZ /d "26H1" /f
        reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v "CurrentBuild" /t REG_SZ /d "22631" /f
        reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v "CurrentBuildNumber" /t REG_SZ /d "22631" /f
        
        # For 32-bit apps
        reg add "HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion" /v "ProductName" /t REG_SZ /d "Windows 11 Pro" /f
        reg add "HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows NT\CurrentVersion" /v "ReleaseId" /t REG_SZ /d "26H1" /f

    # üöÄ SPOOF CPU TO SNAPDRAGON X2 ELITE
    - name: üöÄ Spoof CPU to Snapdragon X2 Elite
      run: |
        reg add "HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\0" /v "ProcessorNameString" /t REG_SZ /d "(‚Å†‚âß‚Å†‚ñΩ‚Å†‚â¶‚Å†) ARM Snapdragon X2 Elite @ 4.2GHz" /f
        reg add "HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\0" /v "VendorIdentifier" /t REG_SZ /d "Qualcomm" /f
        reg add "HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\0" /v "Identifier" /t REG_SZ /d "ARM Family 8 Model D07" /f
        reg add "HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\0" /v "~MHz" /t REG_DWORD /d 4200 /f

    # üéÆ SPOOF GPU
    - name: üéÆ Spoof GPU
      run: |
        reg add "HKLM\SYSTEM\CurrentControlSet\Control\Class\{4d36e968-e325-11ce-bfc1-08002be10318}\0000" /v "DriverDesc" /t REG_SZ /d "NVIDIA GeForce RTX 5090 24GB GDDR7" /f

    # üåê TAILSCALE
    - name: üåê Install Tailscale
      run: |
        Invoke-WebRequest https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi -OutFile $env:TEMP\ts.msi
        Start-Process msiexec -ArgumentList "/i `"$env:TEMP\ts.msi`" /quiet" -Wait

    - name: üîó Connect Tailscale
      run: |
        & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }}
        $ip = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
        echo "TAILSCALE_IP=$ip" >> $env:GITHUB_ENV

    # üü¢ KEEP ALIVE
    - name: üü¢ Keep Alive
      run: |
        Write-Host "========================================"
        Write-Host "‚ùÑÔ∏è  SNOW VM - ARM EDITION"
        Write-Host "========================================"
        Write-Host "OS: Windows 11 Pro 26H1"
        Write-Host "Build: 22631.1 (ARM64)"
        Write-Host "CPU: (‚Å†‚âß‚Å†‚ñΩ‚Å†‚â¶‚Å†) ARM Snapdragon X2 Elite"
        Write-Host "Speed: 4.2GHz (8 cores / 16 threads)"
        Write-Host "GPU: NVIDIA RTX 5090 24GB GDDR7"
        Write-Host "RAM: 16GB LPDDR5X"
        Write-Host ""
        Write-Host "üîó RDP CONNECTION INFO"
        Write-Host "========================================"
        Write-Host "IP: $env:TAILSCALE_IP"
        Write-Host "User: Kiubby"
        Write-Host "Pass: $env:RDP_PASS"
        Write-Host "Port: 3389"
        Write-Host ""
        Write-Host "‚ö° HIGH PERFORMANCE - STABLE"
        Write-Host "========================================"
        Write-Host "‚Ä¢ Optimized for ARM64"
        Write-Host "‚Ä¢ AI Accelerator Support"
        Write-Host "‚Ä¢ Ray Tracing Enabled"
        Write-Host "‚Ä¢ DirectX 13 Ultimate"
        Write-Host "‚Ä¢ Virtualization Enhanced"
        Write-Host "========================================"
        
        while ($true) {
          Start-Sleep 300
        }
